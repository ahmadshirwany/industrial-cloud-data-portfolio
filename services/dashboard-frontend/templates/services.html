{% extends "base.html" %}

{% block title %}Services - Industrial Cloud Dashboard{% endblock %}

{% block content %}
<h2 class="text-3xl font-bold text-gray-900 mb-8">Services Monitoring</h2>

<!-- Services Performance Table -->
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h3 class="text-xl font-semibold text-gray-900 mb-4">Service Performance (Last Hour)</h3>
    <div class="overflow-x-auto">
        <table class="min-w-full">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Service</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Success Rate</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Error Rate</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Avg Response (ms)</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Total Requests</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                {% for service in services %}
                <tr>
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ service.get('service_name', 'N/A') }}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                        <span class="text-green-600 font-semibold">{{ "%.2f"|format(service.get('avg_success_rate', 0)) }}%</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                        <span class="text-red-600 font-semibold">{{ "%.2f"|format(service.get('avg_error_rate', 0)) }}%</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">{{ "%.0f"|format(service.get('avg_response_time', 0)) }}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">{{ "{:,}".format(service.get('total_requests', 0)) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">No services available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Service Instances -->
<div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-xl font-semibold text-gray-900 mb-4">Service Instances</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for instance in instances %}
        <div class="border rounded-lg p-4 border-gray-200">
            <h4 class="text-lg font-semibold text-gray-900 mb-3">{{ instance.get('service_name', 'N/A') }}</h4>
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span class="text-gray-600">Instances Running:</span>
                    <span class="font-semibold text-blue-600">{{ instance.get('instances_running', 0) }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Avg CPU:</span>
                    <span class="font-semibold text-green-600">{{ "%.1f"|format(instance.get('cpu_avg_percent', 0)) }}%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Avg Memory:</span>
                    <span class="font-semibold text-yellow-600">{{ "%.1f"|format(instance.get('memory_avg_percent', 0)) }}%</span>
                </div>
            </div>
        </div>
        {% else %}
        <p class="text-gray-500 col-span-full">No service instances available</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
